#include <stdlib.h>
#include "room.h"
#include "entity_factory.h"

static int getTile(Vector3i v);
static int getTile2(Vector3i v);

Room Graph_loadRoom(int /*roomIdx*/, IGame* /*game*/)
{
  Room r;

  r.name = "test room";

  auto onCell =
    [&] (int x, int y, int z, int /*tile*/)
    {
      auto tile = (x > 8 ? getTile2 : getTile)(Vector3i(x, y, z));
      r.tiles.set(x, y, z, tile);

      if(rand() % 123 == 0)
        r.tiles.set(x, y, z, 1);
    };

  r.tiles.resize(Size3i(64, 64, 16));
  r.tiles.scan(onCell);

  r.start = Vector3i(4, 4, 4);
  r.theme = 2;

  return r;
}

static int const tab[8][8][8] =
{
  {
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
  },
  {
    { 1, 1, 0, 0, 0, 0, 1, 1, },
    { 1, 1, 0, 0, 0, 0, 1, 1, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 1, 1, 0, 0, 0, },
    { 0, 0, 0, 1, 1, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 1, 1, 0, 0, 0, 0, 1, 1, },
    { 1, 1, 0, 0, 0, 0, 1, 1, },
  },
  {
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
  },
  {
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
  },
  {
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
  },
  {
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
  },
  {
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
  },
  {
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
  },
};

static int getTile(Vector3i v)
{
  return tab[v.z % 8][v.y % 8][v.x % 8];
}

int tab2[8][8][8] =
{
  {
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
  },
  {
    { 1, 1, 1, 0, 0, 1, 1, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 1, 0, 0, 0, 0, 0, 1, },
    { 1, 1, 1, 0, 0, 1, 1, 1, },
  },
  {
    { 1, 1, 1, 0, 0, 1, 1, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 1, 0, 0, 0, 0, 0, 1, },
    { 1, 1, 1, 0, 0, 1, 1, 1, },
  },
  {
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 0, 0, 0, 0, 0, 0, 1, },
    { 1, 1, 0, 0, 0, 0, 0, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
  },
  {
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
    { 1, 1, 1, 1, 1, 1, 1, 1, },
  },
  {
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
  },
  {
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
  },
  {
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
    { 0, 0, 0, 0, 0, 0, 0, 0, },
  },
};

static int getTile2(Vector3i v)
{
  return tab2[v.z % 8][v.y % 8][v.x % 8];
}

